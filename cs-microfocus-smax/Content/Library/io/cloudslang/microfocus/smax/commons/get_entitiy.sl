namespace: io.cloudslang.microfocus.smax.commons
flow:
  name: get_entitiy
  inputs:
    - entity_type
    - entity_id
    - fields:
        required: false
    - token
    - tenant_id
    - smax_server
    - smax_port
    - smax_protocol
  workflow:
    - http_client_get:
        do:
          io.cloudslang.base.http.http_client_get:
            - url: "${smax_protocol+'://'+smax_server+':'+smax_port+'/rest/'+tenant_id+'/ems/'+entity_type+'/'+entity_id+'?layout='+str(fields)}"
            - trust_all_roots: 'true'
            - headers: "${'Cookie:LWSSO_COOKIE_KEY='+token}"
        publish:
          - return_result
        navigate:
          - SUCCESS: get_value
          - FAILURE: on_failure
    - get_value:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: 'meta,completion_status'
        publish:
          - completion_status: '${return_result}'
        navigate:
          - SUCCESS: string_equals
          - FAILURE: on_failure
    - get_value_1:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: 'entities,0'
        publish:
          - entity_details: '${return_result}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
    - string_equals:
        do:
          io.cloudslang.base.strings.string_equals:
            - first_string: '${completion_status}'
            - second_string: OK
        navigate:
          - SUCCESS: get_value_1
          - FAILURE: on_failure
  outputs:
    - entity_details: '${entity_details}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      http_client_get:
        x: 100
        'y': 150
      get_value:
        x: 400
        'y': 150
      string_equals:
        x: 700
        'y': 150
      get_value_1:
        x: 1000
        'y': 150
        navigate:
          24e25831-e7fb-09de-75b5-bbcd306f3be4:
            targetId: 5ea46a47-8af1-1c97-c766-198c4ae21246
            port: SUCCESS
    results:
      SUCCESS:
        5ea46a47-8af1-1c97-c766-198c4ae21246:
          x: 1300
          'y': 150
