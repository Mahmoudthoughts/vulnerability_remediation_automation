########################################################################################################################
#!!
#!!#
########################################################################################################################
namespace: io.cloudslang.microfocus.smax.commons
flow:
  name: get_attechment
  inputs:
    - token
    - smax_server: "${get_sp('smax.server')}"
    - smax_protocol: "${get_sp('smax.protocol')}"
    - smax_port: "${get_sp('smax.port')}"
    - tenant_id:
        default: '221857555'
        required: true
    - filename: results.xlsx
    - entity_type: Request
    - entity_id: '10082'
    - attachment_id
    - file_name
    - folder_name
    - content_type
  workflow:
    - http_client_get_file:
        do:
          io.cloudslang.base.http.http_client_get_file:
            - url: "${smax_protocol+'://'+smax_server+':'+smax_port+'/rest/'+tenant_id+'/ces/attachment/'+attachment_id}"
            - auth_type: null
            - trust_all_roots: 'true'
            - headers: "${'Cookie:LWSSO_COOKIE_KEY='+token}"
            - content_type: '${content_type}'
            - destination_file: "${folder_name+entity_type+'_'+entity_id+'_'+file_name}"
        publish:
          - destination_file
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - destination_file: '${destination_file}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      http_client_get_file:
        x: 100
        'y': 150
        navigate:
          a4ea984e-75a3-6461-501b-1fa936597ec0:
            targetId: 7e0ad1d7-41f9-fb32-42e6-19fb77351afd
            port: SUCCESS
    results:
      SUCCESS:
        7e0ad1d7-41f9-fb32-42e6-19fb77351afd:
          x: 400
          'y': 150
