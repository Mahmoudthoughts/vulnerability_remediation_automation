########################################################################################################################
#!!
#! @input username: integration user account
#! @input password: integration user password
#!!#
########################################################################################################################
namespace: io.cloudslang.microfocus.smax.samples
flow:
  name: Get_event_details
  inputs:
    - username: mahmoud
    - password: M@hm0ud@123
    - smax_server: swvm151.hpeswlab.net
    - smax_protocol: https
    - smax_port: '443'
    - tenant_id:
        default: '302842317'
        required: true
  workflow:
    - get_sso_token_by_user:
        do:
          io.cloudslang.microfocus.smax.commons.get_sso_token_by_user: []
        publish:
          - token: '${LWSSO_COOKIE_KEY}'
        navigate:
          - FAILURE: on_failure
          - SUCCESS: get_entitiy
    - get_entitiy:
        do:
          io.cloudslang.microfocus.smax.commons.get_entitiy:
            - entity_type: Request
            - entity_id: '12790'
            - fields: 'Id,Name,Description,UserOptions'
            - token: '${token}'
            - tenant_id: '${tenant_id}'
            - smax_server: '${smax_server}'
            - smax_port: '${smax_port}'
            - smax_protocol: '${smax_protocol}'
        publish:
          - entity_details: "${entity_details.replace('\\\\','').replace('\"{\"','{\"').replace('}\"','}')}"
          - output_0: '${entity_details}'
        navigate:
          - FAILURE: on_failure
          - SUCCESS: get_value_using_dots
    - get_value_using_dots:
        parallel_loop:
          for: "attributes in 'properties.UserOptions.complexTypeProperties[0].properties.MeasurementSLA_c,properties.UserOptions.complexTypeProperties[0].properties.RemediationSLA_c,properties.UserOptions.complexTypeProperties[0].properties.RebootOptions_c,properties.UserOptions.complexTypeProperties[0].properties.NonComplianceAction_c'"
          do:
            io.cloudslang.base-addons.json.get_value_using_dots:
              - json_input: '${entity_details}'
              - json_path: '${attributes}'
        publish:
          - return_result_list: '${str([str(x["return_result"]) for x in branches_context])}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - LWSSO_COOKIE_KEY
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      get_sso_token_by_user:
        x: 100
        'y': 150
      get_entitiy:
        x: 400
        'y': 150
      get_value_using_dots:
        x: 700
        'y': 150
        navigate:
          a2ecb348-f99a-1463-e06f-8c8da6060b2f:
            targetId: a1edf813-7de0-8051-25f8-61da8402d15d
            port: SUCCESS
    results:
      SUCCESS:
        a1edf813-7de0-8051-25f8-61da8402d15d:
          x: 1000
          'y': 150
