namespace: draft
flow:
  name: create_patch_bundle_add_patch
  workflow:
    - get_authentication_token:
        do:
          io.cloudslang.microfocus.dca.authentication.get_authentication_token:
            - idm_host: swdemo10.hpeswlab.net
            - idm_username: transport_admin
            - idm_password:
                value: WhTySQ4TDj
                sensitive: true
            - dca_username: dcaadmin
            - dca_password:
                value: Automation.123
                sensitive: true
            - trust_all_roots: 'true'
        publish:
          - output_0: '${return_code}'
          - output_1: '${return_result}'
          - auth_token
        navigate:
          - SUCCESS: random_number_generator
          - FAILURE: on_failure
    - random_number_generator:
        do:
          io.cloudslang.base.math.random_number_generator:
            - min: '44'
            - max: '656'
        publish:
          - random_number
        navigate:
          - SUCCESS: create_patch_bundle
          - FAILURE: on_failure
    - create_patch_bundle:
        do:
          Operations.create_patch_bundle:
            - name: "${'bundle' + random_number}"
            - policy_name: '${"policy" + random_number}'
            - auth_token: '${auth_token}'
        publish:
          - patch_bundle_id
        navigate:
          - FAILURE: on_failure
          - SUCCESS: add_patchs_to_patch_bundle
    - add_patchs_to_patch_bundle:
        do:
          Operations.add_patchs_to_patch_bundle:
            - patch_bundle_id: '${patch_bundle_id}'
            - auth_token: '${auth_token}'
        navigate:
          - FAILURE: on_failure
          - SUCCESS: SUCCESS
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      get_authentication_token:
        x: 100
        'y': 150
      random_number_generator:
        x: 400
        'y': 150
      create_patch_bundle:
        x: 700
        'y': 150
      add_patchs_to_patch_bundle:
        x: 1000
        'y': 150
        navigate:
          eccd2dc5-2522-60cd-a6cf-7b04dc3eb03c:
            targetId: a4d43a9f-fbae-11b3-e2d2-8d037bbf4403
            port: SUCCESS
    results:
      SUCCESS:
        a4d43a9f-fbae-11b3-e2d2-8d037bbf4403:
          x: 1300
          'y': 150
