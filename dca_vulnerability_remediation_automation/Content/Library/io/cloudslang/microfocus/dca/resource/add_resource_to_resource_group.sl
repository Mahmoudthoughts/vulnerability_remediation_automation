namespace: io.cloudslang.microfocus.dca.resource
flow:
  name: add_resource_to_resource_group
  inputs:
    - auth_token
    - dca_server: "${get_sp('dca.host')}"
    - dca_port: "${get_sp('dca.port')}"
    - dca_protocol: "${get_sp('dca.protocol')}"
    - resource_id
    - resource_group_id
  workflow:
    - http_client_patch:
        do:
          io.cloudslang.base.http.http_client_patch:
            - url: "${dca_protocol+'://'+dca_server+':'+dca_port+'/urest/v1/resource_group/'+resource_group_id+'/resource'}"
            - auth_type: basic
            - trust_all_roots: 'true'
            - headers: "${'X-Auth-Token:' + auth_token}"
            - body: "${'{\"jobName\":\"DCA_ASSOCIATE_TO_RG\",\"targets\":[{\"uuid\":\"'+resource_id+'\",\"type\":\"RESOURCE\",\"ciType\":\"host_node\"}],\"targetsQuery\":\"\",\"uuid\":\"'+resource_group_id+'\"}'}"
            - content_type: application/json
        publish:
          - return_result
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - return_results: '${return_result}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      http_client_patch:
        x: 100
        'y': 150
        navigate:
          8dc890ed-bf57-f5a3-cd83-ffb521e32512:
            targetId: 95d442ec-ebdc-1f08-0f3d-1891e7da28be
            port: SUCCESS
    results:
      SUCCESS:
        95d442ec-ebdc-1f08-0f3d-1891e7da28be:
          x: 400
          'y': 150
