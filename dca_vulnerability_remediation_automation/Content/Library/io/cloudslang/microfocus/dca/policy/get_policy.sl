namespace: io.cloudslang.microfocus.dca.policy
flow:
  name: get_policy
  inputs:
    - name:
        required: true
    - auth_token
    - dca_protocol: "${get_sp('dca.protocol')}"
    - dca_port: "${get_sp('dca.port')}"
    - dca_server: "${get_sp('dca.host')}"
  workflow:
    - get_policy:
        do:
          io.cloudslang.base.http.http_client_get:
            - url: "${dca_protocol+'://'+dca_server+':'+dca_port+'/urest/v1/policy'}"
            - auth_type: basic
            - trust_all_roots: 'true'
            - keystore_password:
                value: null
                sensitive: true
            - headers: "${'X-Auth-Token:' + auth_token}"
            - query_params: "${\"query=name EQ '\"+name+\"'\"}"
            - content_type: application/json
        publish:
          - return_result
        navigate:
          - SUCCESS: get_item_id
          - FAILURE: on_failure
    - get_item_id:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: 'members,0,id'
        publish:
          - item_id: '${return_result}'
        navigate:
          - SUCCESS: get_item_id_1
          - FAILURE: on_failure
    - get_item_id_1:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: 'members,0'
        publish:
          - item_details: '${return_result}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - policy_id: '${item_id}'
    - policy_details: '${item_details}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      get_policy:
        x: 100
        'y': 150
      get_item_id:
        x: 417
        'y': 89
      get_item_id_1:
        x: 580
        'y': 300
        navigate:
          b2dfac68-4277-8151-7b69-61b8e88c7acd:
            targetId: 8c99ed13-83e3-4a65-b46d-303172328980
            port: SUCCESS
    results:
      SUCCESS:
        8c99ed13-83e3-4a65-b46d-303172328980:
          x: 700
          'y': 150
