namespace: io.cloudslang.microfocus.dca.scheduler
flow:
  name: policy_scan
  inputs:
    - policy_id:
        required: true
    - resource_group_name:
        required: true
    - basic_json: |-
        {
            "jobType": {
                "name": "POLICY_SCAN"
            },
            "targets": [],
            "properties": [],
            "targetsQuery": "",
            "schedule": {
                "type": "NOW"
            }
        }
  workflow:
    - add_json_property_to_object:
        do:
          io.cloudslang.base.json.add_json_property_to_object:
            - json_object: '${basic_json}'
            - key: properties
            - value: "${'[{\"property\":\"policyId\",\"value\":\"'+policy_id+'\"}]'}"
        publish:
          - return_result
        navigate:
          - SUCCESS: add_value
          - FAILURE: on_failure
    - add_value:
        do:
          io.cloudslang.base.json.add_value:
            - json_input: '${return_result}'
            - json_path: targetsQuery
            - value: "${\"'/urest/v1/resource?query=parentRG EQ '\"+resource_group_name+\"'\"}"
        publish:
          - return_result
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - full_json: '${return_result}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      add_json_property_to_object:
        x: 100
        'y': 150
      add_value:
        x: 400
        'y': 150
        navigate:
          0993baa5-0d28-58aa-ab7f-b50862f0edc1:
            targetId: 016c20d3-44dd-f457-f07d-ecaaa3453202
            port: SUCCESS
    results:
      SUCCESS:
        016c20d3-44dd-f457-f07d-ecaaa3453202:
          x: 569
          'y': 165
