namespace: io.cloudslang.microfocus.dca.scheduler
flow:
  name: job_creator
  inputs:
    - auth_token:
        required: true
    - full_json
    - dca_server: "${get_sp('dca.host')}"
    - dca_port: "${get_sp('dca.port')}"
    - dca_protocol: "${get_sp('dca.protocol')}"
  workflow:
    - create_job:
        do:
          io.cloudslang.base.http.http_client_post:
            - url: "${dca_protocol+'://'+dca_server+':'+dca_port+'/urest/v1/scheduler/job_request'}"
            - auth_type: basic
            - trust_all_roots: 'true'
            - headers: "${'X-Auth-Token:' + auth_token}"
            - body: '${full_json}'
            - content_type: application/json
        publish:
          - return_result
        navigate:
          - SUCCESS: get_jobs_uuids
          - FAILURE: on_failure
    - get_jobs_uuids:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: uuids
        publish:
          - uuids: '${return_result}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - uuids: '${uuids}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      create_job:
        x: 100
        'y': 150
      get_jobs_uuids:
        x: 364
        'y': 137
        navigate:
          a47cec92-dfde-3a5f-6aaf-d62a6ebc0460:
            targetId: b32d8304-0c98-17df-00bb-9b51cd323d07
            port: SUCCESS
    results:
      SUCCESS:
        b32d8304-0c98-17df-00bb-9b51cd323d07:
          x: 586
          'y': 141
