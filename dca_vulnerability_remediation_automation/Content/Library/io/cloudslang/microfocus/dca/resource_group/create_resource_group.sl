########################################################################################################################
#!!
#! @description: This flow create Resource Group based 
#!               https://docs.microfocus.com/itom/Data_Center_Automation:2019.08/ResourcegroupAPI
#!               
#!!#
########################################################################################################################
namespace: io.cloudslang.microfocus.dca.resource_group
flow:
  name: create_resource_group
  inputs:
    - auth_token
    - dca_server: "${get_sp('dca.host')}"
    - dca_port: "${get_sp('dca.port')}"
    - dca_protocol: "${get_sp('dca.protocol')}"
    - name:
        required: true
    - description:
        required: false
  workflow:
    - create_resource_group:
        do:
          io.cloudslang.base.http.http_client_post:
            - url: "${''+dca_protocol+'://'+dca_server+':'+dca_port+'/urest/v1/resource_group'}"
            - auth_type: basic
            - trust_all_roots: 'true'
            - headers: "${'X-Auth-Token:' + auth_token}"
            - body: "${'{\"name\":\"'+name+'\",\"description\":\"'+description+'\"}'}"
            - content_type: application/json
        publish:
          - return_result
        navigate:
          - SUCCESS: get_item_id
          - FAILURE: on_failure
    - get_item_id:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: id
        publish:
          - item_id: '${return_result}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - resource_group_id: '${item_id}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      create_resource_group:
        x: 100
        'y': 150
        navigate:
          99ac8e1c-cdd8-1a50-aa10-290b59e46df3:
            vertices:
              - x: 175
                'y': 186
            targetId: get_item_id
            port: SUCCESS
      get_item_id:
        x: 400
        'y': 150
        navigate:
          2f336ae0-f85c-df9a-b2cf-e71560f0e713:
            targetId: e5d9e3d0-2ae5-7341-cb01-7d709f3064f0
            port: SUCCESS
    results:
      SUCCESS:
        e5d9e3d0-2ae5-7341-cb01-7d709f3064f0:
          x: 700
          'y': 150
