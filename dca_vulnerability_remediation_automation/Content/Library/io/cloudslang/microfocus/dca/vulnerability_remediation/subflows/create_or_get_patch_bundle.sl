namespace: io.cloudslang.microfocus.dca.vulnerability_remediation.subflows
flow:
  name: create_or_get_patch_bundle
  inputs:
    - name
    - description
    - static_patch_bundle: 'true'
    - auth_token:
        required: false
  workflow:
    - create_patch_bundle:
        do:
          io.cloudslang.microfocus.dca.patch_bundle.create_patch_bundle:
            - name: '${name}'
            - description: '${description}'
            - static_patch_bundle: '${static_patch_bundle}'
            - auth_token: '${auth_token}'
        publish:
          - patch_bundle_id
          - return_result
        navigate:
          - FAILURE: response_handler
          - SUCCESS: SUCCESS
    - response_handler:
        do:
          io.cloudslang.microfocus.dca.handler.response_handler:
            - response: '${return_result}'
        publish: []
        navigate:
          - FAILURE: on_failure
          - SUCCESS: get_patch_bundle
    - get_patch_bundle:
        do:
          io.cloudslang.microfocus.dca.patch_bundle.get_patch_bundle:
            - patch_bundle_name: '${name}'
            - auth_token: '${auth_token}'
        publish:
          - patch_bundle_id
        navigate:
          - FAILURE: on_failure
          - SUCCESS: SUCCESS
  outputs:
    - patch_bundle_id: '${patch_bundle_id}'
    - return_result: '${return_result}'
  results:
    - SUCCESS
    - FAILURE
extensions:
  graph:
    steps:
      create_patch_bundle:
        x: 100
        'y': 250
        navigate:
          abe55e82-553c-944f-0c24-eec473d13120:
            targetId: 7e8802da-e0a5-031a-3e11-d1cc5d624507
            port: SUCCESS
      response_handler:
        x: 400
        'y': 125
        navigate:
          2f73dfee-ae51-f5bb-0b9d-4d2d844550b2:
            vertices:
              - x: 475
                'y': 172
            targetId: get_patch_bundle
            port: SUCCESS
      get_patch_bundle:
        x: 700
        'y': 250
        navigate:
          6eefc3e8-9024-8a3d-abc0-6fccf232be9c:
            targetId: 7e8802da-e0a5-031a-3e11-d1cc5d624507
            port: SUCCESS
    results:
      SUCCESS:
        7e8802da-e0a5-031a-3e11-d1cc5d624507:
          x: 400
          'y': 375
