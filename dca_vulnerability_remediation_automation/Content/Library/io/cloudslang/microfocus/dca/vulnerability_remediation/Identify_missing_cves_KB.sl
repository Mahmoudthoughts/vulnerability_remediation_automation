namespace: io.cloudslang.microfocus.dca.vulnerability_remediation
flow:
  name: Identify_missing_cves_KB
  inputs:
    - username: admin
    - password:
        default: Automation.123
        sensitive: true
    - oo_server: som2.hpeswlab.net
    - port: '8443'
    - protocol: https
    - rows: '1,2,3,4'
  workflow:
    - get_valid_rows:
        do:
          io.cloudslang.microfocus.oo.sample.run_flow:
            - flowUuid: 5a1ae0e4-102e-4981-8c76-94b8ae6944ec
            - inputs: "excelFileName:C:\\qualys\\sample.xlsx|worksheetName:sample|hasHeader:yes|firstRowIndex:0|columnIndextoQuery:0|operator:!=|value:"
            - username: '${username}'
            - password:
                value: '${password}'
                sensitive: true
            - oo_server: '${oo_server}'
            - port: '${port}'
            - protocol: '${protocol}'
        publish:
          - results
        navigate:
          - FAILURE: on_failure
          - SUCCESS: get_value
    - get_value:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${results}'
            - json_path: valid_rows
        publish:
          - rows: '${return_result}'
        navigate:
          - SUCCESS: get_server_vulnerabilities
          - FAILURE: on_failure
    - get_server_vulnerabilities:
        loop:
          for: row in rows
          do:
            io.cloudslang.microfocus.oo.sample.run_flow:
              - flowUuid: 2ec5f196-4c98-4100-a2af-fb22dae4c9ed
              - inputs: "${'rowIndex:'+row+'|columnIndex:1,26,27|excelFileName:C:\\qualys\\sample.xlsx|worksheetName:sample|hasHeader:yes|firstRowIndex:0|rowDelimiter:|columnDelimiter:III'}"
              - username: '${username}'
              - password:
                  value: '${password}'
                  sensitive: true
              - oo_server: '${oo_server}'
              - port: '${port}'
              - protocol: '${protocol}'
          break:
            - FAILURE
          publish:
            - results
        navigate:
          - FAILURE: on_failure
          - SUCCESS: SUCCESS
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      get_valid_rows:
        x: 100
        'y': 250
      get_server_vulnerabilities:
        x: 634
        'y': 243
        navigate:
          e2e51f5e-ca05-bfa3-875c-938790ee3202:
            targetId: 15511e2f-93c0-4b9d-1232-e00aa95e55ce
            port: SUCCESS
      get_value:
        x: 400
        'y': 250
    results:
      SUCCESS:
        15511e2f-93c0-4b9d-1232-e00aa95e55ce:
          x: 1000
          'y': 375
