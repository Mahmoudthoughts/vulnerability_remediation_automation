########################################################################################################################
#!!
#! @description: This flow create Resource Group based 
#!               https://docs.microfocus.com/itom/Data_Center_Automation:2019.08/ResourcegroupAPI
#!!#
########################################################################################################################
namespace: io.cloudslang.microfocus.dca.vulnerability_remediation.subflows
flow:
  name: create_or_get_resource_group
  inputs:
    - auth_token
    - dca_server: "${get_sp('dca.host')}"
    - dca_port: "${get_sp('dca.port')}"
    - dca_protocol: "${get_sp('dca.protocol')}"
    - name:
        required: true
    - description:
        required: false
  workflow:
    - create_resource_group:
        do:
          io.cloudslang.microfocus.dca.resource_group.create_resource_group:
            - auth_token: '${auth_token}'
            - name: '${name}'
            - description: '${description}'
        publish:
          - resource_group_id
          - return_result
        navigate:
          - FAILURE: response_handler_1
          - SUCCESS: SUCCESS
    - response_handler_1:
        do:
          io.cloudslang.microfocus.dca.handler.response_handler:
            - response: '${return_result}'
        publish:
          - output_0: output_0
        navigate:
          - FAILURE: on_failure
          - SUCCESS: get_resource_group
    - get_resource_group:
        do:
          io.cloudslang.microfocus.dca.resource_group.get_resource_group:
            - resource_group_name: '${name}'
            - auth_token: '${auth_token}'
        publish:
          - resource_group_id
        navigate:
          - FAILURE: on_failure
          - SUCCESS: SUCCESS
  outputs:
    - resource_group_id: '${item_id}'
    - return_result: '${return_result}'
  results:
    - SUCCESS
    - FAILURE
extensions:
  graph:
    steps:
      create_resource_group:
        x: 100
        'y': 250
        navigate:
          76ab8cf4-e6cd-7f3d-fe08-99281517b542:
            targetId: 8513e781-d463-fbd7-2fdd-2f234722b9f6
            port: SUCCESS
      response_handler_1:
        x: 400
        'y': 125
      get_resource_group:
        x: 700
        'y': 250
        navigate:
          8e3462cd-b155-d691-e8dd-0d1375563ddf:
            targetId: 8513e781-d463-fbd7-2fdd-2f234722b9f6
            port: SUCCESS
    results:
      SUCCESS:
        8513e781-d463-fbd7-2fdd-2f234722b9f6:
          x: 400
          'y': 375
