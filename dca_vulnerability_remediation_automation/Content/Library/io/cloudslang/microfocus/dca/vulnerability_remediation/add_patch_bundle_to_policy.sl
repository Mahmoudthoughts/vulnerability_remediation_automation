namespace: io.cloudslang.microfocus.dca.vulnerability_remediation
flow:
  name: add_patch_bundle_to_policy
  inputs:
    - policy_name:
        default: RR21334345566_policy
        required: false
    - auth_token:
        required: false
    - patch_bundle_id:
        default: '77'
        required: false
  workflow:
    - get_policy:
        do:
          io.cloudslang.microfocus.dca.policy.get_policy:
            - name: '${policy_name}'
            - auth_token: '${auth_token}'
        publish:
          - policy_id
          - policy_details
        navigate:
          - FAILURE: on_failure
          - SUCCESS: get_value
    - get_value:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${policy_details}'
            - json_path: benchmarks
        publish:
          - return_result
        navigate:
          - SUCCESS: add_object_into_json_array
          - FAILURE: on_failure
    - add_object_into_json_array:
        do:
          io.cloudslang.base.json.add_object_into_json_array:
            - json_array: '${return_result}'
            - json_object: "${'{\"id\": \"'+patch_bundle_id+'\"} '}"
            - index: '0'
        publish:
          - return_result
        navigate:
          - SUCCESS: add_json_property_to_object
          - FAILURE: on_failure
    - add_json_property_to_object:
        do:
          io.cloudslang.base.json.add_json_property_to_object:
            - json_object: '${policy_details}'
            - key: benchmarks
            - value: '${return_result}'
        publish:
          - return_result
        navigate:
          - SUCCESS: update_policy
          - FAILURE: on_failure
    - update_policy:
        do:
          io.cloudslang.microfocus.dca.policy.update_policy:
            - auth_token: '${auth_token}'
            - json: '${return_result}'
            - policy_id: '${policy_id}'
        navigate:
          - FAILURE: on_failure
          - SUCCESS: SUCCESS
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      update_policy:
        x: 1600
        'y': 150
        navigate:
          baab3abe-969c-d759-b116-e472ba878cbb:
            targetId: b8c49ade-eac9-3c79-dea9-34cc571ae92f
            port: SUCCESS
      get_policy:
        x: 400
        'y': 151
      get_value:
        x: 699
        'y': 150
      add_object_into_json_array:
        x: 1000
        'y': 150
        navigate:
          a3d896e3-6571-c88f-19ae-a98e3179f46c:
            vertices:
              - x: 1077
                'y': 178
            targetId: add_json_property_to_object
            port: SUCCESS
      add_json_property_to_object:
        x: 1300
        'y': 150
    results:
      SUCCESS:
        b8c49ade-eac9-3c79-dea9-34cc571ae92f:
          x: 1900
          'y': 150
