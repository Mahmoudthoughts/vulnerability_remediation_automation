########################################################################################################################
#!!
#! @input measure_sla: number of days
#! @input remediation_reboot: value can be like RebootAfterRemediation
#!!#
########################################################################################################################
namespace: io.cloudslang.microfocus.dca.vulnerability_remediation.subflows
flow:
  name: create_or_get_policy
  inputs:
    - auth_token
    - dca_server: "${get_sp('dca.host')}"
    - dca_port: "${get_sp('dca.port')}"
    - dca_protocol: "${get_sp('dca.protocol')}"
    - name:
        required: false
    - description:
        required: false
    - measure_sla
    - remediate_sla
    - remdiation_action:
        required: false
    - remediation_reboot
  workflow:
    - create_policy_1:
        do:
          io.cloudslang.microfocus.dca.policy.create_policy:
            - auth_token: '${auth_token}'
            - name: '${name}'
            - description: '${description}'
            - measure_sla: '${measure_sla}'
            - remediate_sla: '${remediate_sla}'
            - remdiation_action: '${remdiation_action}'
            - remediation_reboot: '${remediation_reboot}'
        publish:
          - policy_id
          - return_result
        navigate:
          - FAILURE: response_handler_2
          - SUCCESS: SUCCESS
    - response_handler_2:
        do:
          io.cloudslang.microfocus.dca.handler.response_handler:
            - response: '${return_result}'
        publish: []
        navigate:
          - FAILURE: on_failure
          - SUCCESS: get_policy
    - get_policy:
        do:
          io.cloudslang.microfocus.dca.policy.get_policy:
            - name: '${name}'
            - auth_token: '${auth_token}'
        publish:
          - policy_id
        navigate:
          - FAILURE: on_failure
          - SUCCESS: SUCCESS
  outputs:
    - policy_id: '${policy_id}'
    - return_result: '${return_result}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      create_policy_1:
        x: 100
        'y': 250
        navigate:
          a25bd403-e113-3748-11d3-3d3178b40aff:
            targetId: bb23dd0f-0284-a26a-7864-3748cd5dfb78
            port: SUCCESS
      response_handler_2:
        x: 400
        'y': 125
      get_policy:
        x: 700
        'y': 250
        navigate:
          4174eda3-db83-05c0-672f-77f76e0c5f87:
            targetId: bb23dd0f-0284-a26a-7864-3748cd5dfb78
            port: SUCCESS
    results:
      SUCCESS:
        bb23dd0f-0284-a26a-7864-3748cd5dfb78:
          x: 400
          'y': 375
