namespace: io.cloudslang.microfocus.dca.patch_bundle
flow:
  name: create_patch_bundle
  inputs:
    - name: teseetg122
    - description: 2fdafdsf
    - static_patch_bundle: 'true'
    - auth_token:
        required: false
  workflow:
    - is_static_policy:
        do:
          io.cloudslang.base.utils.is_true:
            - bool_value: '${static_patch_bundle}'
            - static_policy: '{ "id": "4", "name": "Static" }'
        publish:
          - patch_bundle_type_data: '${static_policy}'
        navigate:
          - 'TRUE': add_value
          - 'FALSE': add_value
    - add_value:
        do:
          io.cloudslang.base.json.add_value:
            - json_input: "${'{    \"name\": \"'+ name +'\",    \"description\": \"' + description + '\"}'}"
            - json_path: type
            - value: '${patch_bundle_type_data}'
        publish:
          - body: '${return_result}'
        navigate:
          - SUCCESS: create_patch_bundle
          - FAILURE: on_failure
    - create_patch_bundle:
        do:
          io.cloudslang.base.http.http_client_post:
            - url: 'https://swdemo10.hpeswlab.net/urest/v1/patch_bundle'
            - auth_type: basic
            - trust_all_roots: 'true'
            - headers: "${'X-Auth-Token:' + auth_token}"
            - body: '${body}'
            - content_type: application/json
        publish:
          - return_json: '${return_result}'
        navigate:
          - SUCCESS: get_patch_bundle_id
          - FAILURE: on_failure
    - get_patch_bundle_id:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_json}'
            - json_path: id
        publish:
          - patch_bundle_id: '${return_result}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
  outputs:
    - patch_bundle_id: '${patch_bundle_id}'
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      is_static_policy:
        x: 73
        'y': 200
        navigate:
          f424ed0e-3eef-1b54-082a-b2bb586ef714:
            vertices: []
            targetId: add_value
            port: 'TRUE'
      add_value:
        x: 172
        'y': 216
      create_patch_bundle:
        x: 421
        'y': 168
      get_patch_bundle_id:
        x: 569
        'y': 272
        navigate:
          7f0b9eec-4f35-2f69-4e08-22cc5725ea96:
            targetId: dae90011-7dc9-46c5-0cc8-72ee7a3be5b3
            port: SUCCESS
    results:
      SUCCESS:
        dae90011-7dc9-46c5-0cc8-72ee7a3be5b3:
          x: 674
          'y': 199
