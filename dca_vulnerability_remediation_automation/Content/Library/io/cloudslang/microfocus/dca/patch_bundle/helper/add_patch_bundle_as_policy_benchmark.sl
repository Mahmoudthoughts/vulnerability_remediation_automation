namespace: io.cloudslang.microfocus.dca.patch_bundle.helper
flow:
  name: add_patch_bundle_as_policy_benchmark
  inputs:
    - patch_bundle_id:
        default: eee
        required: false
    - cves_title: CVE-2019-1142
    - applicable_scopes: MS Windows Server 2016
    - auth_token:
        required: false
    - dca_server:
        required: false
    - dca_port:
        required: false
    - report_in:
        required: false
    - server_name
    - patch_bundle_name
  workflow:
    - patch_query_creator_1:
        do:
          io.cloudslang.microfocus.dca.patch_bundle.helper.patch_query_creator:
            - cves_title: '${cves_title}'
            - applicable_scopes: '${applicable_scopes}'
        publish:
          - body
        navigate:
          - SUCCESS: add_patches
          - FAILURE: on_failure
    - add_patches:
        do:
          io.cloudslang.base.http.http_client_post:
            - url: "${'https://swdemo10.hpeswlab.net/urest/v1/patch_bundle/' + patch_bundle_id + '/patch'}"
            - auth_type: basic
            - trust_all_roots: 'true'
            - headers: "${'X-Auth-Token:' + auth_token}"
            - body: '${body}'
            - content_type: application/json
        publish:
          - return_json: '${return_result}'
        navigate:
          - SUCCESS: report_cve_found
          - FAILURE: report_cve_not_found
    - report_cve_found:
        do:
          io.cloudslang.base-addons.strings.append_new_line:
            - origin_string: '${report_in}'
            - text: "${'Patches for CVE number '+cves_title+' for server '+server_name+' has been added to patch bundle '+patch_bundle_name}"
        publish:
          - report_in: '${new_string}'
        navigate:
          - SUCCESS: SUCCESS
    - report_cve_not_found:
        do:
          io.cloudslang.base-addons.strings.append_new_line:
            - origin_string: '${report_in}'
            - text: "${'No patches found for CVE number '+cves_title+' during reported vulnerbilities for server '+server_name}"
        publish:
          - report_in: '${new_string}'
        navigate:
          - SUCCESS: add_patches
  outputs:
    - report_out: '${report_in}'
  results:
    - SUCCESS
    - FAILURE
extensions:
  graph:
    steps:
      patch_query_creator_1:
        x: 100
        'y': 250
      add_patches:
        x: 400
        'y': 250
      report_cve_found:
        x: 700
        'y': 125
        navigate:
          3adc3ca3-adb7-b3e8-5fe9-e29d2f133271:
            targetId: 98979622-4105-0736-8253-ddec234887dc
            port: SUCCESS
      report_cve_not_found:
        x: 698
        'y': 377
    results:
      SUCCESS:
        98979622-4105-0736-8253-ddec234887dc:
          x: 1000
          'y': 125
