namespace: operations
flow:
  name: cves_query_creator
  inputs:
    - cves_title: cve-123-121
    - applicable_scopes: windows server 2019
  workflow:
    - query_creator:
        do:
          io.cloudslang.base.strings.append:
            - origin_string: "/urest/v1/patch?query=cves.title LIKE '%"
            - text: '${cves_title}'
        publish:
          - output_0: '${new_string}'
        navigate:
          - SUCCESS: append_1
    - add_value:
        do:
          io.cloudslang.base.json.add_value:
            - json_input: '{"query":""}'
            - json_path: query
            - value: '${value}'
        publish:
          - body: '${return_result}'
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: on_failure
    - append_1:
        do:
          io.cloudslang.base.strings.append:
            - origin_string: '${output_0}'
            - text: "%'; AND (applicableScopes EQ '"
        publish:
          - output_1: '${new_string}'
        navigate:
          - SUCCESS: append_2
    - append_2:
        do:
          io.cloudslang.base.strings.append:
            - origin_string: '${output_1}'
            - text: '${applicable_scopes}'
        publish:
          - output_2: '${new_string}'
        navigate:
          - SUCCESS: append_1_1
    - append_1_1:
        do:
          io.cloudslang.base.strings.append:
            - origin_string: '${output_2}'
            - text: "')"
        publish:
          - value: '${new_string}'
        navigate:
          - SUCCESS: add_value
  outputs:
    - body: '${body}'
  results:
    - SUCCESS
    - FAILURE
extensions:
  graph:
    steps:
      query_creator:
        x: 100
        'y': 150
      add_value:
        x: 1300
        'y': 152
        navigate:
          6fc21dd0-7cbb-efec-9057-0867bb19d5ad:
            targetId: 2e123688-6e90-1bc7-0842-fc349644b250
            port: SUCCESS
      append_1:
        x: 400
        'y': 150
      append_2:
        x: 700
        'y': 150
      append_1_1:
        x: 1000
        'y': 150
    results:
      SUCCESS:
        2e123688-6e90-1bc7-0842-fc349644b250:
          x: 1600
          'y': 150
