namespace: operations
flow:
  name: call_oo_flow
  inputs:
    - username:
        default: admin
        required: false
    - password:
        default: Automation.123
        required: false
        sensitive: true
    - server:
        default: som2.hpeswlab.net
        required: false
    - port:
        default: '8443'
        required: false
    - protocol:
        default: https
        required: false
    - uuid:
        required: false
    - inputkeys:
        required: false
    - inputvalues:
        required: false
  workflow:
    - base64_encoder:
        do:
          io.cloudslang.base.utils.base64_encoder:
            - data: "${username +':'+ password}"
        publish:
          - authorization: '${result}'
        navigate:
          - SUCCESS: http_client_get
          - FAILURE: on_failure
    - http_client_post:
        do:
          io.cloudslang.base.http.http_client_post:
            - url: 'https://som2.hpeswlab.net:8443/oo/rest/v1/executions'
            - auth_type: anonymous
            - username: '${username}'
            - password:
                value: '${password}'
                sensitive: true
            - trust_all_roots: 'true'
            - headers: "${'X-CSRF-TOKEN: '  + token}"
            - body: |-
                {
                    "uuid":"06fe8531-868b-4e79-aa7a-13a5e30a66ec",
                    "runName": "",
                    "inputs": {
                        "min": "5343",
                        "max": "6957489"
                    }
                }
            - content_type: application/json
        publish:
          - return_result
        navigate:
          - SUCCESS: get_value
          - FAILURE: on_failure
    - http_client_get:
        do:
          io.cloudslang.base.http.http_client_get:
            - url: 'https://som2.hpeswlab.net:8443/oo/rest/version'
            - trust_all_roots: 'true'
            - headers: "${'Authorization: Basic ' + authorization}"
            - content_type: application/json
        publish:
          - output_0: '${return_result}'
          - response_headers: "${response_headers.replace('\\r', ' ')}"
        navigate:
          - SUCCESS: get_header_value
          - FAILURE: on_failure
    - get_header_value:
        do:
          io.cloudslang.base.http.get_header_value:
            - response_headers: '${response_headers}'
            - header_name: X-CSRF-TOKEN
        publish:
          - token: '${result}'
        navigate:
          - SUCCESS: http_client_post
          - FAILURE: on_failure
    - get_value:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: executionId
        publish:
          - execution_id: '${return_result}'
        navigate:
          - SUCCESS: http_client_get_1
          - FAILURE: on_failure
    - http_client_get_1:
        do:
          io.cloudslang.base.http.http_client_get:
            - url: "${'https://som2.hpeswlab.net:8443/oo/rest/v1/executions/'+execution_id+'/summary'}"
            - auth_type: anonymous
            - trust_all_roots: 'true'
            - headers: "${'X-CSRF-TOKEN: '  + token}"
            - content_type: application/json
        publish:
          - return_result: "${return_result.replace('[','').replace(']', '')}"
        navigate:
          - SUCCESS: get_value_1
          - FAILURE: on_failure
    - get_value_1:
        do:
          io.cloudslang.base.json.get_value:
            - json_input: '${return_result}'
            - json_path: status
        publish:
          - status: '${return_result}'
        navigate:
          - SUCCESS: string_equals
          - FAILURE: on_failure
    - string_equals:
        do:
          io.cloudslang.base.strings.string_equals:
            - first_string: '${status}'
            - second_string: COMPLETED
        navigate:
          - SUCCESS: SUCCESS
          - FAILURE: http_client_get_1
  results:
    - FAILURE
    - SUCCESS
extensions:
  graph:
    steps:
      get_value:
        x: 386
        'y': 277
      get_header_value:
        x: 229
        'y': 302
      http_client_get_1:
        x: 466
        'y': 379
      base64_encoder:
        x: 47
        'y': 392
      string_equals:
        x: 728
        'y': 415
        navigate:
          659ab67f-65fb-fbaf-7baf-0dfc5ce6d92f:
            targetId: 01266d95-6ffe-3ddc-fa84-454dec413626
            port: SUCCESS
      http_client_get:
        x: 120
        'y': 198
      get_value_1:
        x: 580
        'y': 503
      http_client_post:
        x: 259
        'y': 149
    results:
      SUCCESS:
        01266d95-6ffe-3ddc-fa84-454dec413626:
          x: 538
          'y': 169
